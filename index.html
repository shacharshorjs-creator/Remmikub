<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>×¨××™×§×•×‘ â€“ × ×§×•×“×•×ª (v2.7-ml-fixed)</title>
<meta name="theme-color" content="#0e1220">
<style>
  body{margin:0;background:#0e1220;color:#eaf1ff;font:16px system-ui}
  .container{width:min(980px,94vw);margin:0 auto;padding:90px 0 96px}
  .card{background:#151a2b;border:1px solid rgba(255,255,255,.14);border-radius:16px;padding:16px;margin-bottom:12px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  input[type=text],input[type=number]{background:#0b152a;color:#fff;border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:8px 10px}
  button{cursor:pointer;border:none;border-radius:12px;padding:8px 12px;background:#1c2741;color:#fff}
  .accent{background:linear-gradient(135deg,#63c9ff,#8ae9c9);color:#0b1320;font-weight:700}
  .ghost{background:transparent;border:1px dashed rgba(255,255,255,.14)}
  .danger{background:#3a1c1c;color:#ffd9d9;border:1px solid #5a2a2a}
  .leader{display:flex;gap:10px;flex-wrap:wrap}
  .chip{background:#0b1325;border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:8px 12px;display:flex;gap:8px;align-items:center}
  .rank{font-weight:900;width:24px;height:24px;display:grid;place-items:center;border-radius:50%;background:#0d1a2e;border:1px solid rgba(100,200,255,.45)}
  .pill{padding:4px 8px;border-radius:999px;background:#0b172d;border:1px solid rgba(255,255,255,.14)}
  .thumbs{display:flex;flex-wrap:wrap;gap:6px}
  .thumb{border:1px solid rgba(255,255,255,.14);border-radius:8px;padding:4px}
  .bbar{position:fixed;left:0;right:0;bottom:0;height:70px;background:#060a14d9;border-top:1px solid rgba(255,255,255,.14);display:flex;align-items:center;z-index:10}
  .bbar-inner{width:min(980px,94vw);margin:0 auto;display:flex;align-items:center;justify-content:space-between}
</style>
</head>
<body>
<div class="container">
  <section id="s1" class="card">
    <h2>×‘×—×¨ ××©×ª×ª×¤×™×</h2>
    <div class="row"><input id="n0" type="text" placeholder="×©×—×§×Ÿ 1"><input id="n1" type="text" placeholder="×©×—×§×Ÿ 2"></div>
    <div class="row"><input id="n2" type="text" placeholder="×©×—×§×Ÿ 3 (××•×¤×¦×™×•× ×œ×™)"><input id="n3" type="text" placeholder="×©×—×§×Ÿ 4 (××•×¤×¦×™×•× ×œ×™)"></div>
    <button id="startBtn" class="accent">×”×ª×—×œ ××©×—×§</button>
  </section>
  <section id="s2" class="card hidden">
    <div class="row" style="justify-content:space-between"><h2>×œ×•×— ×”×•×‘×œ×”</h2><button id="backBtn" class="ghost">â†© ×—×–×¨×”</button></div>
    <div id="board" class="leader"></div>
    <div id="panels"></div>
    <h3>×ª×•×¦××•×ª ××—×¨×•× ×•×ª</h3><div id="thumbs" class="thumbs"></div>
  </section>
</div>
<div class="bbar"><div class="bbar-inner"><canvas id="lastTile" width="64" height="64"></canvas><div id="lastLabel">â€”</div><button id="clearLast" class="ghost">× ×§×”</button></div></div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  let state={players:[]};
  const $=s=>document.querySelector(s);
  function save(){localStorage.setItem('rummi_state',JSON.stringify(state));}
  function load(){try{state=JSON.parse(localStorage.getItem('rummi_state'))||{players:[]}}catch(e){}}
  load();

  function startGame(){
    const names=['#n0','#n1','#n2','#n3'].map(sel=>$(sel).value.trim()).filter(Boolean);
    const list=names.length?names:['×©×—×§×Ÿ 1','×©×—×§×Ÿ 2'];
    state.players=list.map((n,i)=>({id:String(i+1),name:n,points:0}));
    save(); showGame();
  }
  function showGame(){$('#s1').classList.add('hidden');$('#s2').classList.remove('hidden');render();}
  function back(){$('#s2').classList.add('hidden');$('#s1').classList.remove('hidden');}
  function addPoints(id,d){const p=state.players.find(x=>x.id===id);if(p){p.points+=d;save();render();}}
  function setPoints(id,v){const p=state.players.find(x=>x.id===id);if(p){p.points=v;save();render();}}
  function render(){
    const b=$('#board');b.innerHTML='';state.players.slice().sort((a,b)=>b.points-a.points).forEach((p,i)=>{
      b.innerHTML+=`<div class="chip"><div class="rank">${i+1}</div>${p.name}${i===0?'ğŸ‘‘':''}<div style="margin-inline-start:auto">${p.points} × ×§×³</div></div>`;
    });
    const panels=$('#panels');panels.innerHTML='';state.players.forEach(p=>{
      panels.innerHTML+=`<div class="card"><h3>${p.name}</h3><div>× ×§×•×“×•×ª: <span class="pill">${p.points}</span></div>
      <input type="number" id="num${p.id}" placeholder="+/-"><button onclick="addPoints('${p.id}',Number(document.getElementById('num${p.id}').value)||0)">×¢×“×›×Ÿ</button>
      <button onclick="addPoints('${p.id}',-10)">-10</button></div>`;
    });
  }

  $('#startBtn').onclick=startGame;$('#backBtn').onclick=back;$('#clearLast').onclick=()=>{$('#lastLabel').textContent='â€”';const ctx=$('#lastTile').getContext('2d');ctx.clearRect(0,0,64,64);};
  if(state.players.length)showGame();
});
</script>
</body>
</html>
