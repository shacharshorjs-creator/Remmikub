<!DOCTYPE html><html lang="he" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>×¨××™×§×•×‘ â€“ ××¦×‘ ××©×—×§ (v2.46-ml)</title>
<style>
:root{--bg:#0e1220;--card:#151a2b;--ink:#eaf1ff;--line:rgba(255,255,255,.14);--chip:#0b1325}
html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto}
.container{width:min(980px,94vw);margin:0 auto;padding:100px 0 120px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
button{background:#1c2741;color:#fff;border:none;border-radius:12px;padding:8px 12px;cursor:pointer}
.ghost{background:transparent;border:1px dashed var(--line)}
.ver{font-size:12px;padding:6px 10px;border-radius:999px;background:#0a1a2c;border:1px solid rgba(99,201,255,.4)}
.appbar{position:fixed;inset:0 0 auto 0;height:80px;background:rgba(8,12,24,.82);backdrop-filter:blur(12px);border-bottom:1px solid var(--line);display:flex;align-items:center;z-index:10}
.appbar-inner{width:min(980px,94vw);margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:12px}
.filebtn{background:#1c2741;border:1px solid var(--line);color:#fff;border-radius:12px;padding:12px 16px}
pre{white-space:pre-wrap;max-height:220px;overflow:auto;margin:0}
.hidden{display:none}
</style></head><body>
<div class="appbar"><div class="appbar-inner">
  <div class="row"><strong>×¨××™×§×•×‘ â€“ ××¦×‘ ××©×—×§</strong><span class="ver">v2.46-ml</span><span id="tfBadge" class="ver">TF: initâ€¦</span></div>
  <button id="resetBtn" class="ghost">××™×¤×•×¡</button>
</div></div>

<div class="container">
  <div class="card">ğŸŒ <span id="pageUrl">https://shacharshorjs-creator.github.io/Remmikub/?v=246</span>
    <button onclick="navigator.clipboard.writeText(document.getElementById('pageUrl').textContent)">ğŸ“‹ ×”×¢×ª×§</button>
  </div>

  <section id="trainer" class="card">
    <h3>××™××•×Ÿ ××•×“×œ ×–×™×”×•×™ (CPU ×‘×œ×‘×“)</h3>
    <div class="row">
      <select id="cls"><option value="none">×‘×—×¨/×™ ××¡×¤×¨</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option><option>13</option></select>
      <input id="filePick" class="filebtn" type="file" accept="image/*" multiple>
      <input id="filePickCam" class="filebtn" type="file" accept="image/*" capture="environment">
    </div>
    <div id="counts" class="ver" style="margin-top:8px">×“×•×’×××•×ª: â€”</div>
    <div class="card"><div class="ver">Debug</div><pre id="dbg"></pre></div>
  </section>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const $$ = (id)=>document.getElementById(id);
  const log=(m)=>{ const d=$$('dbg'); d.textContent+=(d.textContent?'\n':'')+m; d.scrollTop=d.scrollHeight; };

  function inject(u,name){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=u; s.async=true;
    s.onload=()=>{ log('loaded '+name+': '+u); res(); }; s.onerror=()=>{ log('FAILED '+name+': '+u); rej(); }; document.head.appendChild(s); }); }

  (async()=>{
    try{ await inject('https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js','tfjs'); }
    catch(e){ try{ await inject('https://unpkg.com/@tensorflow/tfjs@4.20.0/dist/tf.min.js','tfjs'); }catch(e){ $$('#tfBadge').textContent='TF: failed'; return; } }
    // Force CPU first
    try{ await tf.setBackend('cpu'); await tf.ready(); $$('#tfBadge').textContent='TF: '+tf.getBackend(); log('backend: '+tf.getBackend()); }
    catch(e){ $$('#tfBadge').textContent='TF: failed'; log('cpu init failed: '+(e.message||e)); return; }
    // Load models
    try{ await inject('https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0','mobilenet'); }
    catch(e){ await inject('https://unpkg.com/@tensorflow-models/mobilenet@2.1.0','mobilenet'); }
    try{ await inject('https://cdn.jsdelivr.net/npm/@tensorflow-models/knn-classifier@1.2.2','knn-classifier'); }
    catch(e){ await inject('https://unpkg.com/@tensorflow-models/knn-classifier@1.2.2','knn-classifier'); }

    const classifier = knnClassifier.create(); let model=null;
    async function embed(img){ if(!model) model = await mobilenet.load({version:2,alpha:0.35});
      return tf.tidy(()=> model.infer(tf.browser.fromPixels(img).expandDims(0),'conv_preds')); }
    function updateCounts(){
      const ds = classifier.getClassifierDataset(); const keys=Object.keys(ds);
      $$('#counts').textContent = keys.length? ('×“×•×’×××•×ª: '+keys.map(k=>k+': '+(ds[k].shape[0]||0)).join(' | ')) : '×“×•×’×××•×ª: â€”';
    }
    async function addFiles(list){
      const cls = $$('#cls').value; if(cls==='none'){ log('×‘×—×¨/×™ ××¡×¤×¨ ×§×•×“×'); return; }
      for(const f of list){ try{ const img = await new Promise((res,rej)=>{ const im=new Image(); im.onload=()=>res(im); im.onerror=rej; im.src=URL.createObjectURL(f); });
          const e = embed(img); classifier.addExample(e, cls); e.dispose(); log('Added '+(f.name||'file')); await tf.nextFrame();
        }catch(err){ log('ERR '+(err.message||err)); }
      }
      updateCounts();
    }
    const pickers=['filePick','filePickCam'];
    pickers.forEach(id=>{ const el=$$(id); el.addEventListener('change',()=>{ addFiles([...el.files]); el.value=''; }) });
  })();
});
</script>
</body></html>
